<link   href="/Javascript/bootstrap/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />        
<script src="/Javascript/bootstrap/datetimepicker/moment.min.js" type="text/javascript"></script> 
<script src="/Javascript/bootstrap/datetimepicker/bootstrap-datetimepicker.min.js" type="text/javascript"></script> 

<script type="text/javascript">
    var tbot = angular.module("tbot");
    
    tbot.controller("TMUser", function($scope,$http)
        {   
            scope = $scope;
            $("#txtEmail").focus();	
            $scope.update = function(userData)
                {                
                    $scope.result = " ... saving user";
            
                    var picker = $('#expirationDate').datetimepicker();

                    var selectedDate = picker.data('DateTimePicker').getDate();

                    userData.ExpirationDate = "\/Date(" + Date.parse(selectedDate) + ")\/";
                
                    $http.put('/rest/user',userData)
                        .success(function(data)
                            {    
                                $scope.result = (data) ? "(User details saved)" : "Error: Failed to Save user!";
                                
                            });
                };

            var userName = window.location.search.substring(1);
            if (userName != "")
            {
                    $scope.userName = userName;
                    
                    $http.get('/rest/user/' + userName).success(function(data)
                        {
                            $scope.userData = data;

                            var currentExpirationDate = new Date(parseInt($scope.userData.ExpirationDate.replace("/Date(", "").replace(")/",""), 10));

                            var picker = $('#expirationDate').datetimepicker();
                            var dateTimePicker = picker.data('DateTimePicker');
                            dateTimePicker.setDate(currentExpirationDate);
                        });        
            }
            else        
                $scope.userName =  "No username provided";
		
		    $('#expirationDate').datetimepicker({
		      pickTime:false
		    });
        });

</script>

<div ng-controller="TMUser">
    	
    <a href="User_View?userName={{userData.UserName}}" class="btn btn-info" >View User</a>
    <a href="User_Edit?{{userData.UserName}}" class="btn btn-info" disabled>Edit User</a>
    <a href="User_Activities?userName={{userData.UserName}}" class="btn btn-info" >View Activity/Logs</a>
    <a href="User_Raw?userName={{userData.UserName}}">Raw/Xml Data</a>

    <h4>Editing user </h4>
    
    <form name="myForm" class="form-horizontal" role="form" ng-submit="update(userData)">      <!-- change this form to be a directive-->        

        <div class="form-group">
            <label class="col-sm-1 control-label">User ID</label>
            <div class="col-sm-2">
                <p class="form-control-static">{{userData.UserId}}</p>
            </div>
        </div>
       
        <div class="form-group">
            <label  class="col-sm-1 control-label">UserName</label>
            <div class="col-sm-3">
                <input class="form-control" type="text" ng-model="userData.UserName" required ng-disabled="true"/>
            </div>
        </div>

        <div class="form-group">
            <label  class="col-sm-1 control-label">Email</label>
            <div class="col-sm-3">
                <input class="form-control" type="email" id="txtEmail" name="txtEmail" ng-model="userData.Email" required/>
                <span style="color:red;font-weight:bold" ng-show="myForm.txtEmail.$error.required">This field is required!</span>
                <span style="color:red;font-weight:bold" ng-show="myForm.txtEmail.$error.email">Email is invalid!</span>
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-1 control-label">FirstName</label>
            <div class="col-sm-3">
                <input class="form-control"      ng-model="userData.FirstName"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-1 control-label">LastName</label>
            <div class="col-sm-3">
                <input class="form-control" ng-model="userData.LastName"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-1 control-label">Company</label>
            <div class="col-sm-3">
                <input class="form-control" ng-model="userData.Company"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-1 control-label">Job/Title</label>
            <div class="col-sm-3">
                <input class="form-control" ng-model="userData.Title"/>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-1 control-label">Country</label>
            <div class="col-sm-3">
                <input class="form-control" ng-model="userData.Country"/>
            </div>
        </div>
            
        <div class="form-group">
            <label class="col-sm-1 control-label">State</label>
            <div class="col-sm-3">
                <input class="form-control" ng-model="userData.State"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-1 control-label">Expires at:</label>
            <div class="col-sm-3">
                <div class='input-group date' id='expirationDate' data-date-format='MMM/DD/YYYY'>
                    <input type='text' class="form-control" readonly/>
                    <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>       
        
        <div class="form-group">
            <div class="col-sm-offset-1 col-sm-3">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" ng-model="userData.PasswordExpired"/> Password Expired
                    </label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-1 col-sm-3">
                <div class="checkbox">
                    <label>
                        <input type="checkbox" ng-model="userData.UserEnabled"/> User Enabled
                    </label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <div class="col-sm-offset-1 col-sm-3">
                <div class="checkbox">                    
                        <button class="btn btn-primary" ng-disabled="myForm.$invalid" >
                            Save
                        </button>  
                        <span class="result">{{result}}</span>                                            
                </div>
            </div>
        </div>
        
        <!--<label class="checkbox">
                <input type="checkbox" ng-model="userData.PasswordExpired"> <b>Password Expired</b>
            </label>
            <label class="checkbox">
                <input type="checkbox" ng-model="userData.UserEnabled"> <b>User Enabled</b> 
            </label>-->
                    
                    
        <!--
            <label>UserName</label>     <input type="text" class= "input-xxlarge" ng-model="userData.UserName"/>
            <label>Email</label>        <input type="text" class= "input-xxlarge" ng-model="userData.Email"/>       
            <label>First Name</label>   <input type="text" class= "input-xxlarge" ng-model="userData.FirstName"/>
            <label>Last Name</label>    <input type="text" class= "input-xxlarge" ng-model="userData.LastName"/>
            <label>Company</label>      <input type="text" class= "input-xxlarge" ng-model="userData.Company"/>
            <label>Title</label>        <input type="text" class= "input-xxlarge" ng-model="userData.Title"/>
            <label>Job</label>          <input type="text" class= "input-xxlarge" ng-model="userData.Job"/>
            <label>Country</label>      <input type="text" class= "input-xxlarge" ng-model="userData.Country"/>
            <label>State</label>        <input type="text" class= "input-xxlarge" ng-model="userData.State"/>
            -->
        <br/>                    
    </form> 
    <!--
        <small><a href="javascript:window.location = window.location">reload page</a></small>
    -->
    <br/>            
</div>


<!--<style type="text/css">
  .css-form input.ng-invalid.ng-dirty 
  {
    background-color: #FA787E;
  }

  .result {
      font-weight: bold;
      color: #005580;
      margin-left: 10px;
  }

</style>-->

<hr/>
<a href="Current_Users">back to users list</a>